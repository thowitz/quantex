#!/usr/bin/env python3

import click
from blockchain import BlockChain
from wallet import Wallet
from start import start as startProgram
from server import startServer
import sys
import os


@click.group()
def main():
    click.echo("Starting")


@main.command()
def start():
    startProgram()
    print("Starting server now...\n")
    startServer()


@main.command()
@click.argument("create", required=False)
def wallet(create):
    if create:
        createWallet()


def createWallet():
    # I breifly saw somthing about click having user input functionality, so this is temporary
    privateKeyPassword = input("Please enter your private key password: ")

    wallet = Wallet.getInstance()

    # we only want to create and save a private key if the file does not exist, otherwise we could be overwriting an existing one
    if not os.path.isfile("private-key.json"):
        print("\nNo wallet found")
        print("Creating private key...")
        wallet.createPrivateKey()
        print("Done")
        print("Saving private key...")
        wallet.savePrivateKey(privateKeyPassword)
        print("Done")
    else:
        click.echo("\nA wallet already exists, the program will now exit")
        sys.exit()


main()
